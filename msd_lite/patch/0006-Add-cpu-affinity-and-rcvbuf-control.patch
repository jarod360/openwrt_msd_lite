From 0006f5a... Mon Sep 17 00:00:00 2025
From: msd-lite-patcher <patcher@example.com>
Date: 2025-11-19
Subject: [PATCH 0006/0007] Add helpers for SO_RCVBUF and CPU affinity

--- a/src/utils.c
+++ b/src/utils.c
@@
+#include <sys/socket.h>
+#include <sched.h>
+#include <stdio.h>
+
+int set_sock_rcvbuf(int sockfd, int kb) {
+    if (kb <= 0) return -1;
+    int bytes = kb * 1024;
+    int setval = bytes * 2; /* kernel doubles it */
+    if (setsockopt(sockfd, SOL_SOCKET, SO_RCVBUF, &setval, sizeof(setval)) < 0) {
+        perror("setsockopt SO_RCVBUF");
+        return -1;
+    }
+    int actual = 0; socklen_t optlen = sizeof(actual);
+    getsockopt(sockfd, SOL_SOCKET, SO_RCVBUF, &actual, &optlen);
+    printf("SO_RCVBUF set: requested=%d bytes, actual=%d bytes\n", setval, actual);
+    return 0;
+}
+
+int set_thread_affinity(int cpu_id) {
+    cpu_set_t set;
+    CPU_ZERO(&set);
+    CPU_SET(cpu_id, &set);
+    if (sched_setaffinity(0, sizeof(set), &set) != 0) {
+        perror("sched_setaffinity");
+        return -1;
+    }
+    return 0;
+}
